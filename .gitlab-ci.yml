#   _ __   ___  ___  __ _ _ __   __ _
#  | '_ \ / _ \/ __|/ _` | '_ \ / _` |
#  | | | | (_) \__ \ (_| | | | | (_| |
#  |_| |_|\___/|___/\__,_|_| |_|\__,_|

image: node:20.11.1

stages:
  - deploy

test:
  image: node:20.11.1
  stage: pre
  script:
    - npm ci
    - npm run build
    - npm run build:browser
  rules:
    - if: $CI_MERGE_REQUEST_ID
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH

deploy:
  stage: deploy
  only:
    - main
  script:
    - npm ci
    - git config --global user.email "dev@nosana.io"
    - git config --global user.name "Nosana"
    - npm config set '//registry.npmjs.org/:_authToken' "${NPM_TOKEN}"
    - npm run publish:public
    # - git push # todo: fix, not working
